<!DOCTYPE html>
<html>
<head>
  <title>Live Sheet Data</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    .loading:after { content: ' ...'; animation: dots 1s infinite; }
    @keyframes dots { 
      0%, 20% { content: '.'; } 
      40% { content: '..'; } 
      60% { content: '...'; } 
    }
  </style>
</head>
<body>
  <h1>Live Sheet Data <span id="status"></span></h1>
  <button onclick="loadData()">Refresh Data</button>
  <div id="tableContainer"></div>

  <script>
    // This global function will receive the data
    function updateTable(response) {
      const container = document.getElementById('tableContainer');
      let html = '<table>';
      
      // Create headers from first row
      if (response.data.length > 0) {
        html += '<tr>';
        response.data[0].forEach(header => {
          html += `<th>${header}</th>`;
        });
        html += '</tr>';
        
        // Create data rows (skip header if needed)
        const startRow = response.data.length > 1 ? 1 : 0;
        for (let i = startRow; i < response.data.length; i++) {
          html += '<tr>';
          response.data[i].forEach(cell => {
            html += `<td>${cell || ''}</td>`;
          });
          html += '</tr>';
        }
      }
      
      html += '</table>';
      container.innerHTML = html;
      document.getElementById('status').textContent = `Last updated: ${new Date(response.lastUpdated).toLocaleString()}`;
    }

    function loadData() {
      const status = document.getElementById('status');
      status.className = 'loading';
      status.textContent = 'Loading';
      
      // Create script tag to fetch data via JSONP
      const script = document.createElement('script');
      script.src = 'https://script.google.com/macros/s/AKfycbydB_q-qQTW8oOMO0kJy74dk9BOxarm-vUdQ3BU58Mj3_rf3IKsifYsmAYC1IIQNhLb/exec?callback=updateTable&cachebuster=' + Date.now();
      
      // Clean up previous script tags
      document.querySelectorAll('script[data-jsonp]').forEach(el => el.remove());
      script.setAttribute('data-jsonp', 'true');
      
      document.body.appendChild(script);
    }

    // Load data on page load
    window.onload = loadData;
    
    // Optional: Auto-refresh every 30 seconds
    setInterval(loadData, 30000);
  </script>
</body>
</html>
